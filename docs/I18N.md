# Internationalization (i18n) Documentation

This project supports internationalization (i18n) with 4 languages:
- **en** (English) - Default locale
- **ur** (Urdu) - اردو
- **ar** (Arabic) - العربية
- **fa** (Persian/Farsi) - فارسی

## Content Negotiation

The API supports content negotiation through two methods:

### 1. Query Parameter (Recommended)

Add `?locale=` query parameter to any API endpoint:

```bash
# Get events in Arabic
GET /api/events?locale=ar

# Get a specific article in Urdu
GET /api/articles/1?locale=ur

# Get global settings in Persian
GET /api/global?locale=fa

# Get categories in English (default)
GET /api/categories?locale=en
```

### 2. Accept-Language Header

Send the `Accept-Language` header in your HTTP request:

```bash
# Request events with Arabic preferred
curl -H "Accept-Language: ar" http://localhost:1337/api/events

# Request with multiple languages (priority order)
curl -H "Accept-Language: ar-SA,ar;q=0.9,en;q=0.8" http://localhost:1337/api/events
```

**Priority:**
1. Query parameter `?locale=` takes highest priority
2. If no query parameter, `Accept-Language` header is parsed
3. If neither is provided, defaults to `en` (English)

## Localized Content Types

The following content types support localization:
- **events** (`api::event.event`)
- **articles** (`api::article.article`)
- **categories** (`api::category.category`)
- **about** (`api::about.about`) - Single type
- **global** (`api::global.global`) - Single type

## Examples

### Fetching Events

```bash
# English (default)
GET /api/events

# Arabic
GET /api/events?locale=ar

# Urdu
GET /api/events?locale=ur

# Persian
GET /api/events?locale=fa
```

### Using Fetch API (JavaScript)

```javascript
// Using query parameter
const events = await fetch('http://localhost:1337/api/events?locale=ar')
  .then(res => res.json());

// Using Accept-Language header
const events = await fetch('http://localhost:1337/api/events', {
  headers: {
    'Accept-Language': 'ar'
  }
}).then(res => res.json());
```

### Using cURL

```bash
# Query parameter
curl "http://localhost:1337/api/events?locale=ar"

# Accept-Language header
curl -H "Accept-Language: ar" "http://localhost:1337/api/events"
```

## Response Format

When requesting localized content, the API returns:
- Content in the requested locale (if available)
- Metadata including `locale` and `localizations` array
- Related content in other available locales

Example response:
```json
{
  "data": [
    {
      "id": 1,
      "documentId": "abc123",
      "title": "عنوان الحدث",
      "description": "وصف الحدث",
      "locale": "ar",
      "localizations": [
        {
          "id": 1,
          "documentId": "abc123",
          "locale": "en",
          "publishedAt": "2024-01-01T00:00:00.000Z"
        }
      ],
      "publishedAt": "2024-01-01T00:00:00.000Z"
    }
  ],
  "meta": {
    "pagination": { ... }
  }
}
```

## Available Locales

| Code | Name | Status |
|------|------|--------|
| `en` | English | Default |
| `ur` | Urdu (اردو) | Available |
| `ar` | Arabic (العربية) | Available |
| `fa` | Persian (فارسی) | Available |

## Bootstrap Script

To set up locales, run the bootstrap script:

```bash
# Using ts-node
npx ts-node scripts/bootstrap-locales.ts

# Or add to package.json and use npm run
npm run bootstrap:locales
```

This script is **idempotent** - it can be run multiple times safely. It will:
- Create missing locales
- Set default locale (en)
- Verify locale configuration

## Seed Translations

The seed script (`scripts/seed.js`) automatically creates minimal translations for at least one entry per content type in all available locales. This allows QA to verify localization is working correctly.

## Troubleshooting

### Locale Not Found
If you request a locale that doesn't exist or isn't available, the API will:
- Fall back to the default locale (`en`)
- Return content in the default language

### Missing Translations
If a content entry doesn't have a translation for the requested locale:
- The API will attempt to return the entry in the default locale
- The response will indicate which locale is actually being returned

### Invalid Locale Codes
Only these locale codes are supported: `en`, `ur`, `ar`, `fa`
Any other locale code will fall back to `en`.

## Implementation Details

### Middleware
Content negotiation is handled by the `locale-negotiation` middleware located at:
- `src/middlewares/locale-negotiation.js`

This middleware:
1. Checks for `?locale=` query parameter
2. Parses `Accept-Language` header if no query parameter
3. Validates locale is supported
4. Sets default locale if none specified

### Plugin Configuration
i18n plugin is configured in:
- `config/plugins.js`

All public content types have localization enabled via:
- `pluginOptions.i18n.localized: true`

